name: '[DEBUG] Final Check for CodeRabbit Trigger'

on:
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [resolved]

jobs:
  # JOB 1: LUÔN LUÔN CHẠY ĐỂ BẮT SỰ KIỆN
  debug_trigger_event:
    runs-on: ubuntu-latest
    steps:
      - name: 'Print FULL trigger event data to find the correct user login'
        run: |
          echo "--- The event that triggered this workflow has the following data: ---"
          echo "${{ toJSON(github.event) }}"
          echo "--------------------------------------------------------------------"
          echo "::error:: Please copy the JSON block above and send it back for analysis."

  # JOB 2: JOB CŨ CỦA CHÚNG TA (SẼ BỊ SKIPPED)
  evaluate_codereview:
    # Job này cần job debug chạy xong
    needs: debug_trigger_event
    if: |
      (github.event_name == 'pull_request_review' && github.event.review.user.login == 'coderabbitai') ||
      (github.event_name == 'pull_request_review_comment' && github.event.comment.user.login == 'coderabbitai')
    runs-on: ubuntu-latest
    steps:
      - name: This step will be skipped
        run: echo "This job should have run, but was skipped because the 'if' condition was false."
